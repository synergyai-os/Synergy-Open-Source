---
alwaysApply: true
---

## Project: Axon

**Knowledge retention app** using CODE framework (Collect → Organise → Distill → Express).

**Tech Stack:**
- Frontend: SvelteKit 5 + TypeScript + Svelte 5 Runes
- UI: Bits UI (headless) + Tailwind CSS 4 + Semantic Design Tokens
- Backend: Convex (real-time database & serverless functions)
- Mobile: Capacitor 7 (iOS)

---

## Essential Documentation

Read in order:
1. `dev-docs/product-vision-and-plan.md` - Product vision, current state, next steps
2. `dev-docs/2-areas/product-principles.md` - How we make decisions (Privacy First, Outcomes Over Outputs, etc.) ⭐
3. **`dev-docs/patterns/INDEX.md`** - Fast pattern lookup (START HERE for debugging) ⭐
4. `dev-docs/2-areas/component-architecture.md` - Component strategy: Tokens → Utilities → Patterns → Components
5. `dev-docs/2-areas/design-principles.md` - Visual philosophy, accessibility, UX (MANDATORY for UI) ⭐
6. `dev-docs/architecture.md` - Tech stack, auth, composables, project structure
7. `dev-docs/design-tokens.md` - Design token reference (spacing, colors, typography)
8. `dev-docs/composables-analysis.md` - Svelte 5 composables analysis

**Pattern Files** (load as needed):
- `dev-docs/patterns/svelte-reactivity.md` - Svelte 5 runes, composables, $state/$derived
- `dev-docs/patterns/convex-integration.md` - Convex, auth, types, runtime restrictions
- `dev-docs/patterns/ui-patterns.md` - UI/UX, design tokens, layout
- `dev-docs/patterns/analytics.md` - PostHog, server-side tracking

**Future Architecture:**
- `dev-docs/multi-tenancy-migration.md` - Multi-tenancy architecture and migration guide (when implementing orgs/teams)

---

## Project-Specific Workflows

**Note**: `/save` and `/root-cause` commands are universal - see `.cursor/commands/start.md`

**For this project:**
- `/root-cause`: Load `dev-docs/patterns/INDEX.md` → scan symptom table → jump to line number
- `/save`: Add pattern to domain file (svelte-reactivity.md, etc.) → update INDEX.md

---

## Design Token System - MANDATORY

**NEVER use hardcoded values:**
- ❌ `px-2`, `py-1.5`, `gap-2` → ✅ `px-nav-item`, `py-nav-item`, `gap-icon`
- ❌ `bg-gray-900`, `text-white` → ✅ `bg-sidebar`, `text-sidebar-primary`
- ❌ `text-[10px]` → ✅ `text-label`

**Why**: Tokens adapt to light/dark mode automatically. Change once in `src/app.css`, updates everywhere.

**Reference**: `dev-docs/design-tokens.md` - Full token list
**Before adding**: Check `dev-docs/design-tokens.md`, add to `src/app.css` @theme block first, then document

---

## Svelte 5 Composables Pattern

**Structure:**
- Extension: `.svelte.ts` (required for runes)
- Location: `src/lib/composables/`
- Pattern: Single `$state` object with getter returns
- Types: Explicit TypeScript return types

**Pattern: Single `$state` Object**
```typescript
const state = $state({ isSyncing: false, error: null });
return {
  get isSyncing() { return state.isSyncing; },
  get error() { return state.error; }
};
```

**Pattern: Function Parameters for Reactive Values**
```typescript
export function useX(items: () => Item[], onSelect: (id: string) => void) {
  const current = items(); // Get current value
}
```

**Pattern: Reactive Queries**
```typescript
const query = useQuery(api.module.function, () => ({ filter: false }));
const data = $derived(query?.data ?? []);
```

**Available Composables:**
- `useInboxItems` - Inbox queries and filtering
- `useSelectedItem` - Selected item state
- `useInboxSync` - Readwise sync operations
- `useKeyboardNavigation` - J/K navigation
- `useInboxLayout` - Layout state

**See**: `dev-docs/patterns/INDEX.md` for all patterns

---

## Key Files

**Documentation:**
- `dev-docs/2-areas/development/coding-standards.md` - **Coding rules for AI agents** ⭐ CRITICAL
- `dev-docs/patterns/INDEX.md` - Pattern lookup (START HERE)
- `dev-docs/patterns/svelte-reactivity.md` - Svelte 5 patterns
- `dev-docs/patterns/convex-integration.md` - Convex patterns
- `dev-docs/patterns/ui-patterns.md` - UI/UX patterns
- `dev-docs/patterns/analytics.md` - PostHog patterns
- `dev-docs/architecture.md` - Tech architecture
- `dev-docs/design-tokens.md` - Token reference
- `dev-docs/product-vision-and-plan.md` - Vision and roadmap

**Code:**
- `src/lib/composables/` - Composables (`.svelte.ts`)
- `src/lib/components/` - UI components
- `src/app.css` - Design token definitions
- `convex/schema.ts` - Database schema

**Commands:**
- `.cursor/commands/save.md` - Save patterns workflow
- `.cursor/commands/root-cause.md` - Debug workflow

---

## Best Practices

**Before Writing Code:**
1. **Read `dev-docs/2-areas/development/coding-standards.md`** - CRITICAL: Prevents linting errors ⭐
2. Check `patterns/INDEX.md` for existing patterns
3. Use design tokens (never hardcode)
4. Follow composables pattern (`.svelte.ts`, single `$state`, getters)
5. Use Context7 for library docs

**Coding Standards (MANDATORY for AI Agents):**
- ❌ NEVER use `any` type (use proper types or `unknown` + type guards)
- ❌ NEVER use `{#each}` without keys `(item._id)`
- ❌ NEVER use `goto()` without `resolveRoute()`
- ❌ NEVER use `Map`/`Set` (use `SvelteMap`/`SvelteSet` or plain objects)
- ❌ NEVER leave unused imports/variables
- ✅ ALWAYS use TypeScript types
- ✅ ALWAYS use design tokens
- ✅ ALWAYS use `.svelte.ts` for composables
- ✅ ALWAYS use `useQuery()` for Convex data

**See**: `dev-docs/2-areas/development/coding-standards.md` for complete rules

**When Debugging:**
1. Use `/root-cause` → Load `patterns/INDEX.md`
2. Scan symptom table → jump to line number in domain file
3. Use Context7 for verification
4. Only fix if 95%+ confident

**Common Mistakes:**
- Hardcoded values (use tokens)
- Missing `.svelte.ts` extension
- Multiple `$state` variables (use single object)
- Direct value access in composables (use function parameters)
- Manual queries (use `useQuery()`)

---

## Starting a Task

1. Read `dev-docs/product-vision-and-plan.md` - Understand current state
2. Check `dev-docs/patterns/INDEX.md` - See if patterns exist
3. Review `dev-docs/design-tokens.md` - If building UI
4. Check `dev-docs/architecture.md` - If working on architecture
5. Use Context7 - For latest library documentation
