# Meetings Module - Essentials

## Data Entities

### Core Entities (from Core Module)

- **Users** - System users (from Core module)
- **Organizations** - Organizations users belong to (from Core module)
- **Circles** - Work organization units, hierarchical (can have parent circle)
- **Circle Members** - Many-to-many relationship between users and circles
- **Circle Roles** - Organizational roles within circles (e.g., "Circle Lead", "Facilitator")
  - Belong to a specific circle (`circleId`)
  - Examples: "Circle Lead", "Dev Lead", "Facilitator"
- **User Circle Roles** - Many-to-many assignments of users to circle roles
  - Users can fill multiple roles across different circles
  - Roles can have multiple users filling them

### Meeting Entities

- **Meetings** - Scheduled meetings with recurrence support
  - Has organizer (createdBy), required meeting type, optional circle
  - Supports ad-hoc meetings (no circle) and circle-based meetings
  - Privacy controls: `public`, `circle`, `private`
  - Real-time session state: `startedAt`, `currentStep`, `closedAt`, `secretaryId`
  - Recurrence: daily, weekly, monthly with optional end date

- **Meeting Types** - Built-in categories for meetings (enum, defined by system)
  - Values: `standup`, `retrospective`, `planning`, `1-on-1`, `client`, `governance`, `weekly-tactical`, `general`
  - Required field for reporting and analytics
  - **System-defined**: Types are built into the system by SynergyOS developers
  - **User-selectable**: Users with access can select from available types when creating meetings

- **Meeting Attendees** - Polymorphic attendees (user/role/circle/guest)
  - Can invite specific users, roles (anyone filling a role), or entire circles
  - Supports flexible meeting participation models
  - **Guests** - Unregistered users who can join via secure invite links
    - Guests are not logged in or registered users
    - Access granted via special secure invite link generated by registered users
    - Any registered user can generate invite link when meeting is scheduled or running
    - Guests can only access the specific meeting they're invited to
    - Links are secure and meeting-specific (cannot access other meetings)

- **Meeting Agenda Items** - Real-time collaborative agenda items
  - Has title, order, optional markdown notes, processing timestamp (`processedAt`)
  - Created by any participant, can be marked as processed during meeting
  - Processing state: empty `processedAt` = not processed, timestamp present = processed

- **Meeting Action Items** - Tasks (next steps) captured during meetings
  - Always type: `next-step` (action items are individual tasks)
  - Can optionally link to projects (see Projects module)
  - Polymorphic assignment: user OR role
  - Status: `todo`, `in-progress`, `done` (bi-directional sync with external tools)
  - Linked to agenda items for traceability
  - Optional due dates and circle association
  - **External Tool Sync**: Can sync to Linear, Notion, etc. (via project link or individually)

- **Meeting Templates** - User-created reusable meeting structures
  - Organization-level templates (created by users with RBAC permissions)
  - Built using meeting types (templates reference a meeting type)
  - Can be created by roles/circles with appropriate RBAC access
  - Used to create meetings with predefined structure and steps
  - Default templates (Governance, Weekly Tactical) seeded on organization creation but may be edited and adjusted by users with access rights.

- **Meeting Template Steps** - Ordered agenda steps for templates
  - Step types: `check-in`, `agenda`, `metrics`, `projects`, `closing`, `custom`
  - Has title, optional description, order index, optional timebox
  - Defined by users when creating/editing templates

- **Meeting Presence** - Real-time tracking of who's in the meeting
  - Tracks active participants via heartbeat (30s intervals)
  - Used for attendance tracking during check-in step

- **Secretary Change Requests** - Workflow for changing meeting secretary/facilitator
  - Status: `pending`, `approved`, `denied`
  - Requires approval from current secretary

## Relationships

### Users & Circles

- Users ↔ Circles: Many-to-many via `circleMembers` (users can belong to multiple circles)
- Circles: Self-referential hierarchy via `parentCircleId` (parent/child relationships)
- Circle → Circle Roles: One-to-many (roles belong to a specific circle via `circleId`)
- Users ↔ Circle Roles: Many-to-many via `userCircleRoles`
  - Users can fill multiple roles (across different circles)
  - Roles can have multiple users filling them

### Meetings

- Meeting → Organization: Many-to-one (required)
- Meeting → Creator: Many-to-one (user via `createdBy`)
- Meeting → Circle: Many-to-one (optional, null = ad-hoc meeting)
- Meeting → Meeting Type: Many-to-one (required enum)
- Meeting → Template: Many-to-one (optional, via `templateId`)
- Meeting → Secretary: Many-to-one (user via `secretaryId`, defaults to `createdBy`)

### Meeting Attendees

- Meeting ↔ Attendees: One-to-many via `meetingAttendees`
- Attendee → User: Many-to-one (when `attendeeType = 'user'`)
- Attendee → Circle Role: Many-to-one (when `attendeeType = 'role'`)
- Attendee → Circle: Many-to-one (when `attendeeType = 'circle'`)

### Meeting Structure

- Meeting → Agenda Items: One-to-many via `meetingAgendaItems`
- Meeting → Action Items: One-to-many via `meetingActionItems`
- Meeting → Presence: One-to-many via `meetingPresence`
- Meeting → Secretary Requests: One-to-many via `secretaryChangeRequests`

### Agenda Items & Related Entities

- Agenda Item → Action Items: One-to-many (action items linked via `agendaItemId`)

### Templates

- Meeting Template → Template Steps: One-to-many via `meetingTemplateSteps`
- Meeting Template → Organization: Many-to-one (required)
- Meeting Template → Meeting Type: References a built-in meeting type (templates are built using types)
- Meeting can be created from Template: Template steps guide meeting structure (not copied directly)
- **Access Control**: Templates can be created by users with RBAC permissions (roles/circles with access)
- **Default Templates**: System seeds default templates (Governance, Weekly Tactical) on organization creation

## Business Logic

### Meeting Lifecycle

1. **Scheduled** - Meeting created with start time, duration, attendees
2. **Started** - Any assigned user can start meeting (`startedAt` set, `currentStep` initialized to `'check-in'`)
3. **In Progress** - Meeting moves through steps: `check-in` → `agenda` → `closing`
4. **Closed** - Secretary closes meeting (`closedAt` set)

### Meeting Steps

- **Predefined Step Types**: System provides step types: `check-in`, `agenda`, `metrics`, `projects`, `closing`, `custom`
- **Essential Core Steps**: Most meetings include these three essential steps:
  - **Check-in** - Opening round, attendance tracking via presence system
  - **Agenda** - Process agenda items, take notes, create action items
  - **Closing** - Recap action items and next steps
- **Additional Steps**: Meetings can have more steps based on:
  - Meeting template (templates define which steps to include)
  - Meeting type (different types may require different step sequences)
  - Custom steps (users can add custom steps to templates)
- **Step Configuration**: Steps are defined in meeting templates, but can be customized per meeting

### Agenda Items

- Any participant can add agenda items during the meeting
- Agenda items have optional markdown notes for taking notes
- Processing state: `processedAt` (timestamp, empty = not processed, timestamp present = processed)
- When processed, agenda items move to "Processed" section
- Secretary controls which agenda item is active/focused
- **Benefits of timestamp**: Enables analytics (when processed, duration from creation), processing order tracking

### Action Items

- Created from agenda items during meeting
- Always type: `next-step` (individual tasks, not projects)
- Can optionally link to projects (see Projects module for project management)
- Can be assigned to specific users or roles (polymorphic assignment)
- Status workflow: `todo` → `in-progress` → `done`
- **Bi-directional Sync**: Status syncs with external project management tools (Linear, Notion, etc.)
- Optional due dates and circle association
- **External Tool Integration**: Action items can sync to external tools individually or via project link

### Secretary/Facilitator

- **Default Roles**: Secretary and Facilitator are default roles in every circle
- **Default Assignment**: Defaults to meeting creator (`createdBy`)
- **Terminology**: "Secretary" is the default wording but can be customized by organization admin
- **Absent Secretary Handling**:
  - If secretary is not present when meeting starts, the first person joining becomes temporary secretary
  - When the assigned secretary arrives, they automatically become secretary
- **Manual Change**: Can be changed via secretary change request workflow
- **Meeting Access**: Any assigned user can see and start a meeting
- **Secretary-only Actions**: Only secretary can:
  - Advance steps
  - Close meeting
  - Switch active agenda item (during agenda step)

### Attendee Access

- **Registered Users**:
  - Direct invite: User explicitly invited
  - Role-based: User fills an invited role
  - Circle-based: User is member of invited circle
- **Guests** (Unregistered users):
  - Access via secure invite link generated by registered users
  - Any registered user can generate invite link when meeting is scheduled or running
  - Links are secure and meeting-specific (cannot access other meetings)
  - Guests can participate like regular users but only in the meeting they're invited to
  - Guests appear in presence tracking as "guests" (unexpected joiners)
- **Visibility rules**:
  - `public`: All org members can see
  - `circle`: Only circle members can see (if circle-based meeting)
  - `private`: Only invited attendees can see

### Recurrence

- Supports daily, weekly, monthly recurrence
- Weekly recurrence can specify days of week (e.g., Mon/Wed/Fri)
- Optional end date for recurring meetings
- Each recurrence instance is a separate meeting record

### Presence Tracking

- Real-time heartbeat system (30s intervals)
- Tracks active participants in meeting
- Used for attendance during check-in step
- Distinguishes expected attendees (invited) from guests (unexpected joiners)
