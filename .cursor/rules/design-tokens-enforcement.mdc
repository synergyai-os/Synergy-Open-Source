---
alwaysApply: false
---
# üö® DESIGN TOKEN ENFORCEMENT (MANDATORY)

**This rule is AUTOMATICALLY loaded for EVERY .svelte file you edit.**

**CSS Components**: Use Recipe System (CVA) - NO exceptions
**SVG Components**: Documented exception allowed (SYOS-522) - Requires comment

---

## ‚õî HARD RULE #1: NO Hardcoded Values

### ‚ùå FORBIDDEN (Violations will be REJECTED):

**Pixel/rem values as strings:**

```svelte
width="1rem" // ‚ùå REJECTED height="32px" // ‚ùå REJECTED const size = '1rem'; // ‚ùå REJECTED const
dims = '2rem'; // ‚ùå REJECTED
```

**Hex colors:**

```svelte
color="#3b82f6" // ‚ùå REJECTED bg-[#000000] // ‚ùå REJECTED const color = '#fff'; // ‚ùå REJECTED
```

**Decimal opacity:**

```svelte
opacity: 0.5 // ‚ùå REJECTED const alpha = 0.75; // ‚ùå REJECTED
```

**Raw Tailwind utilities:**

```svelte
class="px-4 py-2" // ‚ùå REJECTED class="text-2xl" // ‚ùå REJECTED class="rounded-lg" // ‚ùå REJECTED
class="gap-2" // ‚ùå REJECTED
```

---

### ‚úÖ REQUIRED (Token References ONLY):

**Utility classes (reference tokens):**

```svelte
class="w-icon-sm h-icon-sm" // ‚úÖ Uses var(--size-icon-sm) class="px-button-x py-button-y" // ‚úÖ
Uses var(--spacing-button-x) class="bg-accent-primary" // ‚úÖ Uses var(--color-accent-primary)
class="opacity-disabled" // ‚úÖ Uses var(--opacity-disabled) class="font-heading" // ‚úÖ Uses
var(--fonts-heading)
```

**CSS custom properties (direct references):**

```svelte
<div style="width: var(--size-icon-sm)">      // ‚úÖ Direct token reference
<div style="padding: var(--spacing-button-x)"> // ‚úÖ Direct token reference
```

---

## ‚õî HARD RULE #2: "Matching Values" ‚â† "Using Tokens"

### The #1 Mistake Agents Make:

**‚ùå WRONG thinking:**

```
Token: --size-icon-sm = 1rem
Agent: "I'll use 1rem - it matches the token!" ‚Üê THIS IS HARDCODING
Result: Cascade BROKEN (changing token won't update code)
```

**‚úÖ CORRECT thinking:**

```
Token: --size-icon-sm = 1rem
Agent: "I'll use w-icon-sm utility - it REFERENCES the token"
Result: Cascade WORKS (changing token updates all code automatically)
```

### Real Example from Production:

**‚ùå Agent wrote (REJECTED):**

```svelte
// Agent thought: "These match the token values!" const dimensions = $derived( size === 'sm' ?
'1rem' : size === 'lg' ? '3rem' : '2rem' ); // ‚ùå HARDCODED - Cascade broken, violates design system
```

**‚úÖ Should have been:**

```svelte
// References tokens via CSS classes const sizeClasses = $derived( size === 'sm' ? 'w-icon-sm
h-icon-sm' : size === 'lg' ? 'w-icon-lg h-icon-lg' : 'w-icon-md h-icon-md' ); // ‚úÖ Uses tokens -
Cascade works, design system maintained
```

---

## ‚õî HARD RULE #3: CSS Components MUST Use Recipe System

### ‚ö†Ô∏è **UPDATED (SYOS-513)**: Recipe System is Primary Approach

**For CSS-based components** (Button, Badge, Card, Input, etc.):

‚úÖ **REQUIRED**: Use CVA Recipe System (type-safe, foolproof, AI-scalable)
‚úÖ Recipes return CSS class names (token-based utilities)
‚úÖ Component props map to recipe variants automatically

**‚ùå REJECTED**: Manual token mapping for CSS components (not scalable, AI agents fail)

### Recipe System Pattern (CSS Components):

**‚úÖ CORRECT (Recipe System):**

```svelte
<script lang="ts">
	import { buttonRecipe } from '$lib/design-system/recipes/button.recipe';

	type Props = {
		variant?: 'solid' | 'outline';
		size?: 'sm' | 'md' | 'lg';
	};

	let { variant = 'solid', size = 'md' }: Props = $props();

	const classes = $derived(buttonRecipe({ variant, size }));
</script>

<button class={classes}>
	<slot />
</button>
```

**‚ùå WRONG (Manual token mapping):**

```svelte
<script lang="ts">
	// ‚ùå REJECTED: Manual mapping (AI agents fail, not scalable)
	const classes = $derived(
		size === 'sm' ? 'h-button-sm px-button-x-sm' : 'h-button-md px-button-x'
	);
</script>
```

**üìñ Reference Examples:**
- Complete template: `ai-docs/reference/recipe-template.md` (Button recipe example)
- Working example: `ai-docs/reference/cva-svelte-example/` (Button component with recipe)
- Pattern documentation: `dev-docs/2-areas/patterns/recipe-system.md`

---

## ‚õî HARD RULE #4: SVG Components ARE Acceptable Exception

### ‚ö†Ô∏è **UPDATED (SYOS-522)**: SVG Exception Documented

**Discovery**: CSS-based sizing (recipes/utility classes) is **unreliable for SVG** in some browsers.

**For SVG-based components** (Loading, Icon, OrgChart, D3 visualizations):

‚úÖ **ACCEPTABLE EXCEPTION**: Hardcoded pixel dimensions in HTML attributes or inline styles
‚úÖ **REQUIRED**: Exception comment at top of `<script>` block referencing SYOS-522
‚úÖ **REASON**: CSS `width`/`height` unreliable for SVG; requires explicit HTML attributes

### SVG Exception Pattern:

**‚úÖ CORRECT (SVG Exception with Documentation):**

```svelte
<script lang="ts">
	/**
	 * DESIGN SYSTEM EXCEPTION: SVG/D3 Visualization (SYOS-522)
	 *
	 * This component uses SVG with hardcoded pixel dimensions because:
	 * 1. CSS-based sizing (recipes/utility classes) unreliable for SVG in some browsers
	 * 2. Requires explicit HTML width/height attributes
	 * 3. Token mapping via JavaScript computed styles (where dynamic needed)
	 *
	 * Approved exception - see dev-docs/2-areas/design/design-tokens.md
	 */

	type Props = {
		size?: 'sm' | 'md' | 'lg';
	};

	let { size = 'md' }: Props = $props();
</script>

<svg width={size === 'sm' ? '12px' : '16px'} height={size === 'sm' ? '12px' : '16px'}>
	<!-- ‚úÖ ACCEPTABLE: Documented SVG exception -->
	<circle cx="8" cy="8" r="6" />
</svg>
```

**‚ùå WRONG (No exception comment):**

```svelte
<script lang="ts">
	// ‚ùå REJECTED: Missing exception documentation
	type Props = { size?: 'sm' | 'md' };
	let { size = 'md' }: Props = $props();
</script>

<svg width="16" height="16">
	<!-- ‚ùå REJECTED: No SYOS-522 reference -->
</svg>
```

**‚ùå WRONG (CSS component using SVG exception):**

```svelte
<script lang="ts">
	// ‚ùå REJECTED: Button is CSS component, must use recipe system
</script>

<button style="width: 32px; height: 32px;">
	<!-- ‚ùå REJECTED: Not SVG, no exception allowed -->
</button>
```

---

### Decision Tree: Recipe vs SVG Exception

**Ask yourself:**

> "Is this a CSS-based component or SVG-based component?"

**Decision:**

```
‚îú‚îÄ CSS Component (Button, Card, Badge, Input, Alert, etc.)
‚îÇ  ‚îî‚îÄ ‚úÖ USE RECIPE SYSTEM (CVA)
‚îÇ     - No exceptions allowed
‚îÇ     - Type-safe variant props
‚îÇ     - Scalable for AI agents
‚îÇ
‚îî‚îÄ SVG Component (Loading, Icon, OrgChart, D3 visualizations)
   ‚îî‚îÄ ‚úÖ ACCEPTABLE EXCEPTION
      - Document with SYOS-522 comment
      - Use HTML attributes or inline styles
      - Only for SVG elements
```

---

## üéØ The Cascade Test (Use BEFORE Writing Code)

**Ask yourself:**

> "If I change a design token value in design-system.json, will this code update automatically?"

**Examples:**

```svelte
<!-- TEST 1: CSS Component (Button) - Change --size-button-md from 2.5rem to 3rem -->

<!-- ‚ùå FAILS: Hardcoded value stays 2.5rem -->
<button style="height: 2.5rem">

<!-- ‚ùå FAILS: Manual token mapping (not scalable) -->
const classes = $derived(size === 'md' ? 'h-button-md' : 'h-button-sm');

<!-- ‚úÖ PASSES: Recipe system automatically updates to 3rem -->
const classes = $derived(buttonRecipe({ size: 'md' }));

<!-- TEST 2: SVG Component (Loading) - Documented Exception -->

<!-- ‚úÖ PASSES: SVG exception documented with SYOS-522 comment -->
/**
 * DESIGN SYSTEM EXCEPTION: SVG/D3 Visualization (SYOS-522)
 * ...
 */
<svg width="16" height="16">

<!-- ‚ùå FAILS: SVG exception without documentation -->
<svg width="16" height="16">  // Missing SYOS-522 comment
```

**If cascade test FAILS ‚Üí You're hardcoding OR missing documentation ‚Üí FIX IT before writing code**

---

## üìã Token Utility Quick Reference

### Sizes (NOT hardcoded px/rem):

```svelte
‚úÖ w-icon-sm, h-icon-md, w-icon-lg ‚ùå width="1rem", height="32px", w-[16px]
```

### Spacing (NOT raw Tailwind):

```svelte
‚úÖ px-button-x, py-button-y, gap-icon ‚ùå px-4, py-2, gap-2
```

### Colors (NOT hex/named colors):

```svelte
‚úÖ bg-accent-primary, text-primary, border-base ‚ùå bg-blue-600, text-white, bg-[#3b82f6]
```

### Opacity (NOT decimal values):

```svelte
‚úÖ opacity-disabled, opacity-hover, opacity-backdrop ‚ùå opacity-50, opacity: 0.5, bg-*/50
```

### Fonts (NOT base tokens):

```svelte
‚úÖ font-heading, font-body, font-code ‚ùå font-sans, font-mono (these are base, use semantic)
```

### Border Radius (NOT raw Tailwind):

```svelte
‚úÖ rounded-button, rounded-card, rounded-input ‚ùå rounded-md, rounded-lg, rounded-xl
```

### Breakpoints (Tailwind responsive utilities OK):

```svelte
‚úÖ md:grid-cols-3, lg:px-content-padding ‚ùå @media (min-width: 768px), hardcoded breakpoints
```

---

## üö® ENFORCEMENT PROCESS

### Step 1: BEFORE Writing Code

1. Run cascade test mentally for EVERY value
2. If value is literal (`'1rem'`, `'#fff'`, `0.5`) ‚Üí STOP, use token
3. If value matches token ‚Üí Still STOP, reference token instead

### Step 2: DURING Implementation

1. After writing code, run: `npm run tokens:validate`
2. If violations found ‚Üí FIX immediately, don't continue
3. Validate again until clean

### Step 3: BEFORE Committing

1. Run: `npm run lint`
2. If design token violations ‚Üí REJECTED, fix first
3. Pre-commit hook will enforce this

---

## ‚ö†Ô∏è Common Agent Mistakes (Learn from These)

### Mistake #1: "Values match tokens"

**Agent wrote:**

```svelte
size === 'sm' ? '1rem' : '2rem' // "These match --size-icon-sm/md!"
```

**Why rejected:** Hardcoded strings, cascade broken
**Correct:** `size === 'sm' ? 'w-icon-sm' : 'w-icon-md'`

### Mistake #2: "Using manual tokens for CSS components"

**Agent wrote:**

```svelte
const classes = $derived(size === 'sm' ? 'h-button-sm' : 'h-button-md'); // "Manual mapping!"
```

**Why rejected:** Manual token mapping doesn't scale, AI agents fail
**Correct:** Use recipe system - `const classes = $derived(buttonRecipe({ size }))`

### Mistake #3: "Just this once"

**Agent wrote:**

```svelte
const spacing = '8px'; // "Quick fix, will refactor later"
```

**Why rejected:** "Later" never happens, use tokens NOW
**Correct:** `class="gap-icon"` (uses var(--spacing-icon))

### Mistake #4: "Base tokens are fine"

**Agent wrote:**

```svelte
class="font-sans" // "It's a token!"
```

**Why rejected:** Base token, not semantic (no component context)
**Correct:** `class="font-heading"` (semantic, clear usage)

---

## üìñ Where to Find Tokens

**Complete catalog:** `dev-docs/2-areas/design/design-tokens.md`

**Quick search:**

```bash
# Find available size tokens
grep "size-icon" dev-docs/2-areas/design/design-tokens.md

# Find spacing tokens
grep "spacing-button" dev-docs/2-areas/design/design-tokens.md

# Find color tokens
grep "bg-accent" dev-docs/2-areas/design/design-tokens.md
```

**Can't find a token?**

1. Check `dev-docs/2-areas/design/design-tokens.md` FIRST
2. If truly missing ‚Üí Ask user to add it to design-system.json
3. NEVER hardcode as workaround

---

## üéØ Remember

**This is NOT guidance - this is ENFORCEMENT.**

**For CSS Components (Button, Card, Badge, etc.):**

- ‚ùå Writing literal values ‚Üí Code will be REJECTED
- ‚ùå Manual token mapping ‚Üí REJECTED (not scalable)
- ‚ùå "Matching" token values ‚Üí Still REJECTED (must use recipe)
- ‚úÖ Using Recipe System (CVA) ‚Üí APPROVED

**For SVG Components (Loading, Icon, OrgChart, etc.):**

- ‚ùå Hardcoded values without documentation ‚Üí REJECTED
- ‚úÖ Documented exception with SYOS-522 comment ‚Üí APPROVED
- ‚úÖ Explicit HTML attributes or inline styles ‚Üí APPROVED

**CSS Components: Use recipes or don't commit.**
**SVG Components: Document exception or don't commit.**

---

**Last Updated**: 2025-11-23
**Purpose**: Automatic enforcement of design token usage in ALL Svelte files
**Severity**: CRITICAL - Violations block commits
**Updated**: Recipe System (SYOS-513) + SVG Exception (SYOS-522)
