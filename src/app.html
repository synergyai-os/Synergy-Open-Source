<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta
			name="viewport"
			content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover"
		/>
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
		<meta name="theme-color" content="#000000" />
		<script>
			// Prevent FOUC (Flash of Unstyled Content) by applying theme immediately
			(function () {
				try {
					const stored = localStorage.getItem('axon-theme');
					const theme =
						stored === 'light' || stored === 'dark'
							? stored
							: window.matchMedia('(prefers-color-scheme: dark)').matches
								? 'dark'
								: 'light';

					if (theme === 'dark') {
						document.documentElement.classList.add('dark');
						document.documentElement.classList.remove('light');
					} else {
						document.documentElement.classList.add('light');
						document.documentElement.classList.remove('dark');
					}
				} catch (e) {
					// Fallback to dark mode if localStorage access fails
					document.documentElement.classList.add('dark');
				}
			})();

			// Prevent overlay flash during account/workspace switching
			(function () {
				try {
					const switchingData = sessionStorage.getItem('switchingAccount');
					if (switchingData) {
						const data = JSON.parse(switchingData);
						// Sanitize accountName to prevent XSS
						const rawAccountName = data.accountName || 'workspace';
						const accountName = String(rawAccountName).replace(/[<>"'&]/g, function (char) {
							switch (char) {
								case '<':
									return '&lt;';
								case '>':
									return '&gt;';
								case '"':
									return '&quot;';
								case "'":
									return '&#39;';
								case '&':
									return '&amp;';
								default:
									return char;
							}
						});

						// Inject overlay HTML immediately (before Svelte loads)
						document.addEventListener('DOMContentLoaded', function () {
							const overlay = document.createElement('div');
							overlay.id = '__switching-overlay';

							// Create elements safely without innerHTML
							const container = document.createElement('div');
							container.style.cssText =
								'position:fixed;inset:0;z-index:9999;display:flex;align-items:center;justify-content:center;background:linear-gradient(to bottom right,rgba(37,99,235,0.1),var(--color-bg-base,#ffffff),rgba(37,99,235,0.05));backdrop-filter:blur(24px);-webkit-backdrop-filter:blur(24px)';

							const innerDiv = document.createElement('div');
							innerDiv.style.cssText =
								'display:flex;flex-direction:column;align-items:center;gap:2rem';

							const spinnerWrapper = document.createElement('div');
							spinnerWrapper.style.cssText = 'position:relative;width:48px;height:48px';

							const spinner = document.createElement('div');
							spinner.style.cssText =
								'position:absolute;inset:0;border-radius:9999px;border:4px solid var(--color-border-base,rgba(0,0,0,0.1));border-top-color:var(--color-accent-primary,rgb(37,99,235));animation:__spin 1s linear infinite';

							const textWrapper = document.createElement('div');
							textWrapper.style.cssText = 'text-align:center;max-width:28rem';

							const heading = document.createElement('h2');
							heading.style.cssText =
								'font-size:1.5rem;font-weight:600;color:var(--color-text-primary,rgb(17,24,39))';
							heading.textContent = 'Loading ' + accountName + "'s workspace"; // Safe: uses textContent

							const subTextWrapper = document.createElement('div');
							subTextWrapper.style.cssText = 'text-align:center';

							const subText = document.createElement('p');
							subText.style.cssText =
								'font-size:0.875rem;color:var(--color-text-secondary,rgb(107,114,128))';
							subText.textContent = 'Gathering user data';

							const style = document.createElement('style');
							style.textContent = '@keyframes __spin { to { transform: rotate(360deg); } }';

							spinnerWrapper.appendChild(spinner);
							textWrapper.appendChild(heading);
							subTextWrapper.appendChild(subText);
							innerDiv.appendChild(spinnerWrapper);
							innerDiv.appendChild(textWrapper);
							innerDiv.appendChild(subTextWrapper);
							container.appendChild(innerDiv);
							overlay.appendChild(container);
							overlay.appendChild(style);
							document.body.appendChild(overlay);

							// Set a marker so Svelte knows to clean this up
							window.__hasStaticOverlay = true;
						});
					}
				} catch (e) {
					// Silently fail if sessionStorage isn't available
					console.warn('Could not check switching state', e);
				}
			})();
		</script>
		%sveltekit.head%
	</head>
	<body data-sveltekit-preload-data="hover">
		<div style="display: contents">%sveltekit.body%</div>
	</body>
</html>
